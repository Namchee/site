---
import type { HTMLAttributes } from 'astro/types';

import { Image as Img } from '@unpic/astro';
import { getPixels } from '@unpic/pixels';

type Props = HTMLAttributes<'img'>;

// the maximum image width on 1023px
const MAX_WIDTH = 670;

const { alt, src } = Astro.props;

const { width, height } = await getPixels(src!);
const scaledHeight = Math.ceil(MAX_WIDTH / width * height);
---

<figure class=":uno: my-4 overflow-x-visible md:w-[calc(100%+32px)] md:-ml-4">
  <Img
    src={src!}
    alt={alt}
    title={alt}
    width={MAX_WIDTH}
    height={scaledHeight}
    class=":uno: rounded-md"
    placeholder="blurhash"
    loading="lazy"
  />

  <figcaption class=":uno: text-xs mt-2 text-center italic">
    {alt}
  </figcaption>
</figure>
