---
import { Icon } from "astro-iconify";

import AppLink from "@/components/astro/ui/AppLink.astro";

import { getInsight } from "@/scripts/carbon";

const links = [
  {
    label: "Home",
    href: "/",
    mobile: false,
  },
  {
    label: "Bookshelf",
    href: "/bookshelf",
    mobile: false,
  },
  {
    label: "Posts",
    href: "/posts",
    mobile: false,
  },
  {
    label: "Colophon",
    href: "/colophon",
    mobile: true,
  },
];

const location = import.meta.env.PROD
  ? Astro.url.pathname
  : "https://developer.mozilla.org/en-US/";

const { time, carbon } = await getInsight(location);
---

<footer
  class="grid grid-cols-12 gap-4
  w-full max-w-7xl mx-auto
  p-8
  text-sm"
>
  <div class="flex flex-col items-center col-start-1 col-end-13 border-t border-border pt-6
    md:flex-row md:justify-between lg:col-start-3 lg:col-end-11">
    <p class="text-balance hidden md:text-nowrap md:block">
      This page loads in <span
        title="Measured from speed index"
        class="font-medium text-link">{time.toFixed(2)} seconds</span
      > and emits <span
        title="Measured from bytes transferred per page view"
        class="font-medium text-link"
      >{carbon.toFixed(2)} grams</span> of CO<sub>2</sub>
    </p>

    <div class="w-full md:w-auto flex items-center space-x-4">
      {
        links.map((link) => (
          <AppLink
            href={link.href}
            title={link.label}
            class={`transition-colors text-link hover:text-accent focus:text-accent ${link.mobile && 'md:hidden'}`}
          >
            {link.label}
          </AppLink>
        ))
      }
    </div>
  </div>


  <div class="flex flex-col items-center col-start-1 col-end-13 space-y-6
    md:flex-row md:justify-between lg:col-start-3 lg:col-end-11 md:space-y-0">
    <div class="w-full md:w-auto flex">
      <span>All contents are licensed under</span>
       &nbsp;
      <AppLink
        external
        href="http://creativecommons.org/licenses/by/4.0"
        rel="license noopener noreferrer"
        class="flex items-center text-link hover:text-accent transition-colors font-medium space-x-1"
      >
        <span>CC BY 4.0</span>
        <img
          class="h-4 w-auto -mt-1"
          src="https://mirrors.creativecommons.org/presskit/icons/cc.svg"
        /><img
          class="h-4 w-auto -mt-1"
          src="https://mirrors.creativecommons.org/presskit/icons/by.svg"
        />
      </AppLink>
    </div>

    <AppLink
      href="/colophon"
      class="w-full md:w-auto text-link hover:text-accent focus:text-accent transition-colors hidden md:block"
    >
      Colophon
    </AppLink>
  </div>
</footer>
